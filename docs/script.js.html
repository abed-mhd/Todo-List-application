<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: script.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: script.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { filterTasksByCompletion, countTasks, generateRandomID } from './utils.js';

log.setLevel("info"); // I chose 'info', but i could have set it to 'warn', 'debug', 'error'
//log.setLevel("error"); 
//log.setLevel("warn"); 
//log.setLevel("debug"); // Looks the same as 'info' to me.

const ListsContainer = document.querySelector('[data-lists-container]');
const ListForm = document.querySelector('[data-new-list-form]');
const ListInput = document.querySelector('[data-new-list-input]');
const ListTasksContainer = document.getElementById('list-tasks');
const HeaderTitle = document.querySelector('[data-header-title]');
const HeaderTasksRemaining = document.querySelector('[data-header-tasks-remaining]');
const TasksContainer = document.querySelector('[data-tasks-container]')
const TaskForm = document.querySelector('[data-new-task-form]');
const TaskInput = document.querySelector('[data-new-task-input]');
const ClearTasksButton = document.querySelector('[data-clear-tasks-button]');
const ClearListButton = document.querySelector('[data-delete-list-button]');

ClearListButton.addEventListener('click', () => {
    DeleteSelectedList();
});

ClearTasksButton.addEventListener('click', () => {
    ClearCheckedTasks();
});

const LOCAL_STORAGE_LISTS_KEY = 'task.lists';
const LOCAL_STORAGE_SELECTED_ID_KEY = 'list.id';
let lists = JSON.parse(localStorage.getItem(LOCAL_STORAGE_LISTS_KEY)) || [];
let selected_id = localStorage.getItem(LOCAL_STORAGE_SELECTED_ID_KEY);

ListForm.addEventListener('submit', e => {
    e.preventDefault();
    const ListName = ListInput.value;
    if (!ListName) {
        log.warn('Attempted to create a list with an empty name');
        return;
    }
    const List = CreateList(ListName);
    lists.push(List);
    ListInput.value = null;
    log.info(`New list created: ${ListName}`);
    render();
    Save();
});

TaskForm.addEventListener('submit', e => {
    e.preventDefault();
    const TaskName = TaskInput.value;
    if (!TaskName) {
        log.warn('Attempted to create a task with an empty name');
        return;
    }
    const Task = CreateTask(TaskName);
    TaskInput.value = null;
    const selectedList = lists.find(list => list.id === selected_id);
    selectedList.tasks.push(Task);
    log.info(`New task created: ${TaskName} for list ${selectedList.name}`);
    render();
    Save();
});

ListsContainer.addEventListener('click', e => {
    if (e.target.tagName.toLowerCase() === 'li') {
        selected_id = e.target.dataset.id;
        render();
        Save();
    }
});

TasksContainer.addEventListener('click', e => {
    if (e.target.tagName.toLowerCase() === 'div') {
        const selectedList = lists.find(list => list.id === selected_id);
        const selectedTask = selectedList.tasks.find(task => task.id ===
            e.target.querySelector('input').id);
        selectedTask.completed = !selectedTask.completed;
        render();
        Save();
    }
});

/**
 * Renders the lists and tasks in the UI.
 */
function render() {
    ClearElement(ListsContainer);
    if (lists.length === 0) return;

    lists.forEach(list => {
        const listElement = document.createElement('li');
        listElement.classList.add('list');
        listElement.dataset.id = list.id;
        if (listElement.dataset.id === selected_id) {
            ClearElement(TasksContainer);
            listElement.classList.add('selected');
            ListTasksContainer.style.display = 'block';

            const completedTasks = filterTasksByCompletion(list.tasks, true);

            list.tasks.forEach(task => {
                const Task = document.createElement('div');
                Task.classList.add('task');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = task.id;
                checkbox.checked = task.completed;
                checkbox.classList.add('checkboxex');
                const Label = document.createElement('label');
                Label.htmlFor = task.id;
                Label.innerText = task.name;
                Task.append(checkbox, Label);
                TasksContainer.append(Task);
            });

            HeaderTitle.innerText = list.name;
            HeaderTasksRemaining.innerText = `${list.tasks.length - completedTasks.length} Tasks Remaining`;
        }
        listElement.innerText = list.name;
        ListsContainer.append(listElement);
    });
}

/**
 * Clears all children of a given DOM element.
 * @param {HTMLElement} element - The element to clear.
 */
function ClearElement(element) {
    while (element.firstChild) {
        element.removeChild(element.firstChild);
    }
}

/**
 * Creates a new list object.
 * @param {string} name - The name of the list.
 * @returns {Object} - The created list object.
 */
function CreateList(name) {
    return { id: generateRandomID(), name: name, tasks: [] };
}

/**
 * Creates a new task object.
 * @param {string} name - The name of the task.
 * @returns {Object} - The created task object.
 */
function CreateTask(name) {
    return { name: name, id: generateRandomID(), completed: false };
}

/**
 * Saves the current state of lists and the selected list ID to local storage.
 */
function Save() {
    try {
        localStorage.setItem(LOCAL_STORAGE_LISTS_KEY, JSON.stringify(lists));
        localStorage.setItem(LOCAL_STORAGE_SELECTED_ID_KEY, selected_id);
    } catch (error) {
        log.error(`Failed to save tasks: ${error.message}`);
    }
}

/**
 * Deletes the selected list and updates the UI.
 */
function DeleteSelectedList() {
    lists = lists.filter(list => list.id !== selected_id);
    selected_id = null;
    ListTasksContainer.style.display = 'none';
    log.trace('Selected list deleted');
    render();
    Save();
}

/**
 * Clears all completed tasks from the selected list.
 */
function ClearCheckedTasks() {
    const selectedList = lists.find(list => list.id === selected_id);
    if (!selectedList) return;

    const initialTaskCount = selectedList.tasks.length;
    selectedList.tasks = filterTasksByCompletion(selectedList.tasks, false);

    const deletedTaskCount = initialTaskCount - selectedList.tasks.length;
    log.info(`${deletedTaskCount} tasks cleared from list ${selectedList.name}`);
    render();
    Save();
}

render();
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#ClearCheckedTasks">ClearCheckedTasks</a></li><li><a href="global.html#ClearElement">ClearElement</a></li><li><a href="global.html#CreateList">CreateList</a></li><li><a href="global.html#CreateTask">CreateTask</a></li><li><a href="global.html#DeleteSelectedList">DeleteSelectedList</a></li><li><a href="global.html#Save">Save</a></li><li><a href="global.html#countTasks">countTasks</a></li><li><a href="global.html#filterTasksByCompletion">filterTasksByCompletion</a></li><li><a href="global.html#generateRandomID">generateRandomID</a></li><li><a href="global.html#render">render</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Sun Dec 01 2024 13:31:03 GMT+0100 (heure normale dâ€™Europe centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
